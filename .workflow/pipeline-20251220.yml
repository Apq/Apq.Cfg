version: '1.0'
name: pipeline-20251220
displayName: 发布到NuGet
triggers:
  trigger: auto
  push:
    tags:
      include:
        - ^v\d+\.\d+\.\d+(-[\w.]+)?$
variables:
  global:
    - NUGET_API_KEY
stages:
  - name: stage-1549ccd4
    displayName: 打包并发布
    strategy: naturally
    trigger: auto
    executor: []
    steps:
      - step: execute@docker
        name: execute_by_docker
        displayName: 打包并发布到NuGet
        certificate: ''
        image: registry.cn-chengdu.aliyuncs.com/apq/dotnet_sdk:9.0_amd64
        command:
          - 'dotnet restore Apq.Cfg/Apq.Cfg.csproj && dotnet restore Apq.Cfg.Ini/Apq.Cfg.Ini.csproj && dotnet restore Apq.Cfg.Xml/Apq.Cfg.Xml.csproj && dotnet restore Apq.Cfg.Yaml/Apq.Cfg.Yaml.csproj && dotnet restore Apq.Cfg.Toml/Apq.Cfg.Toml.csproj && dotnet restore Apq.Cfg.Redis/Apq.Cfg.Redis.csproj && dotnet restore Apq.Cfg.Database/Apq.Cfg.Database.csproj && dotnet pack Apq.Cfg/Apq.Cfg.csproj -c Release -o ./nupkgs && dotnet pack Apq.Cfg.Ini/Apq.Cfg.Ini.csproj -c Release -o ./nupkgs && dotnet pack Apq.Cfg.Xml/Apq.Cfg.Xml.csproj -c Release -o ./nupkgs && dotnet pack Apq.Cfg.Yaml/Apq.Cfg.Yaml.csproj -c Release -o ./nupkgs && dotnet pack Apq.Cfg.Toml/Apq.Cfg.Toml.csproj -c Release -o ./nupkgs && dotnet pack Apq.Cfg.Redis/Apq.Cfg.Redis.csproj -c Release -o ./nupkgs && dotnet pack Apq.Cfg.Database/Apq.Cfg.Database.csproj -c Release -o ./nupkgs && for pkg in ./nupkgs/*.nupkg; do dotnet nuget push "$pkg" -s https://api.nuget.org/v3/index.json -k ${NUGET_API_KEY} --skip-duplicate; done'
        notify: []
        strategy:
          retry: '0'
