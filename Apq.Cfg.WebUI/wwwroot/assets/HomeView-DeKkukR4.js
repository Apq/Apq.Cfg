import{d as Q,g as w,h as X,i as b,e as d,j as Y,b as t,w as l,r as n,k as Z,l as g,a as y,m as ee,o as r,f as i,n as V,F as te,p as le,t as k,E as p,q as oe}from"./index-DvA1iGEF.js";import{u as ae}from"./apps-ko24tNTa.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./request-D0JHu2Jz.js";const se={class:"home-container"},ue={class:"page-header"},de={class:"card-header"},re={class:"app-name"},ie={class:"app-info"},pe={class:"app-url"},me={class:"app-auth"},ce={key:0,class:"app-desc"},_e={class:"app-actions"},fe=Q({__name:"HomeView",setup(ve){const B=ee(),u=ae(),m=w(!1),_=w(null),h=w(!1),a=w({name:"",url:"",authType:"None",apiKey:"",token:"",description:""});X(()=>{u.fetchApps()});function J(s){switch(s){case"ApiKey":return"warning";case"JwtBearer":return"success";default:return"info"}}function N(s){switch(s){case"ApiKey":return"API Key";case"JwtBearer":return"JWT";default:return"无认证"}}function P(s){B.push(`/app/${s}`)}function U(s,e){switch(s){case"edit":_.value=e,a.value={name:e.name,url:e.url,authType:e.authType,apiKey:e.apiKey||"",token:e.token||"",description:e.description||""},m.value=!0;break;case"test":I(e);break;case"delete":D(e);break}}async function I(s){try{await u.testConnection(s.id)?p.success("连接成功"):p.error("连接失败")}catch{p.error("连接失败")}}async function D(s){try{await oe.confirm(`确定要删除应用 "${s.name}" 吗？`,"确认删除",{type:"warning"}),await u.deleteApp(s.id),p.success("删除成功")}catch{}}async function F(){if(!a.value.name||!a.value.url){p.warning("请填写必填项");return}h.value=!0;try{_.value?(await u.updateApp(_.value.id,a.value),p.success("更新成功")):(await u.addApp(a.value),p.success("添加成功")),m.value=!1,M()}catch{p.error("操作失败")}finally{h.value=!1}}function M(){_.value=null,a.value={name:"",url:"",authType:"None",apiKey:"",token:"",description:""}}return(s,e)=>{const $=n("Plus"),C=n("el-icon"),f=n("el-button"),q=n("MoreFilled"),A=n("el-dropdown-item"),E=n("el-dropdown-menu"),S=n("el-dropdown"),W=n("el-tag"),H=n("el-card"),K=n("el-col"),L=n("el-empty"),j=n("el-row"),v=n("el-input"),c=n("el-form-item"),T=n("el-option"),z=n("el-select"),R=n("el-form"),G=n("el-dialog"),O=Z("loading");return r(),b("div",se,[d("div",ue,[e[10]||(e[10]=d("h2",null,"应用管理",-1)),t(f,{type:"primary",onClick:e[0]||(e[0]=o=>m.value=!0)},{default:l(()=>[t(C,null,{default:l(()=>[t($)]),_:1}),e[9]||(e[9]=i(" 添加应用 ",-1))]),_:1})]),Y((r(),y(j,{gutter:20},{default:l(()=>[(r(!0),b(te,null,le(g(u).apps,o=>(r(),y(K,{xs:24,sm:12,md:8,lg:6,key:o.id},{default:l(()=>[t(H,{class:"app-card",shadow:"hover"},{header:l(()=>[d("div",de,[d("span",re,k(o.name),1),t(S,{onCommand:x=>U(x,o)},{dropdown:l(()=>[t(E,null,{default:l(()=>[t(A,{command:"edit"},{default:l(()=>[...e[11]||(e[11]=[i("编辑",-1)])]),_:1}),t(A,{command:"test"},{default:l(()=>[...e[12]||(e[12]=[i("测试连接",-1)])]),_:1}),t(A,{command:"delete",divided:""},{default:l(()=>[...e[13]||(e[13]=[i("删除",-1)])]),_:1})]),_:1})]),default:l(()=>[t(f,{text:""},{default:l(()=>[t(C,null,{default:l(()=>[t(q)]),_:1})]),_:1})]),_:1},8,["onCommand"])])]),default:l(()=>[d("div",ie,[d("p",pe,k(o.url),1),d("p",me,[t(W,{size:"small",type:J(o.authType)},{default:l(()=>[i(k(N(o.authType)),1)]),_:2},1032,["type"])]),o.description?(r(),b("p",ce,k(o.description),1)):V("",!0)]),d("div",_e,[t(f,{type:"primary",onClick:x=>P(o.id)},{default:l(()=>[...e[14]||(e[14]=[i("查看配置",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128)),g(u).apps.length===0&&!g(u).loading?(r(),y(K,{key:0,xs:24,sm:12,md:8,lg:6},{default:l(()=>[t(L,{description:"暂无应用，点击上方按钮添加"})]),_:1})):V("",!0)]),_:1})),[[O,g(u).loading]]),t(G,{modelValue:m.value,"onUpdate:modelValue":e[8]||(e[8]=o=>m.value=o),title:_.value?"编辑应用":"添加应用",width:"500px"},{footer:l(()=>[t(f,{onClick:e[7]||(e[7]=o=>m.value=!1)},{default:l(()=>[...e[15]||(e[15]=[i("取消",-1)])]),_:1}),t(f,{type:"primary",onClick:F,loading:h.value},{default:l(()=>[...e[16]||(e[16]=[i("保存",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(R,{model:a.value,"label-width":"100px"},{default:l(()=>[t(c,{label:"应用名称",required:""},{default:l(()=>[t(v,{modelValue:a.value.name,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.name=o),placeholder:"如：订单服务"},null,8,["modelValue"])]),_:1}),t(c,{label:"API 地址",required:""},{default:l(()=>[t(v,{modelValue:a.value.url,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.url=o),placeholder:"如：http://localhost:5000/api/apqcfg"},null,8,["modelValue"])]),_:1}),t(c,{label:"认证方式"},{default:l(()=>[t(z,{modelValue:a.value.authType,"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.authType=o),style:{width:"100%"}},{default:l(()=>[t(T,{label:"无认证",value:"None"}),t(T,{label:"API Key",value:"ApiKey"}),t(T,{label:"JWT Bearer",value:"JwtBearer"})]),_:1},8,["modelValue"])]),_:1}),a.value.authType==="ApiKey"?(r(),y(c,{key:0,label:"API Key"},{default:l(()=>[t(v,{modelValue:a.value.apiKey,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.apiKey=o),placeholder:"输入 API Key"},null,8,["modelValue"])]),_:1})):V("",!0),a.value.authType==="JwtBearer"?(r(),y(c,{key:1,label:"Token"},{default:l(()=>[t(v,{modelValue:a.value.token,"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.token=o),type:"textarea",placeholder:"输入 JWT Token"},null,8,["modelValue"])]),_:1})):V("",!0),t(c,{label:"备注"},{default:l(()=>[t(v,{modelValue:a.value.description,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.description=o),type:"textarea",placeholder:"可选"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),ke=ne(fe,[["__scopeId","data-v-8e3c89d2"]]);export{ke as default};
