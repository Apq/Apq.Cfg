# Apq.Cfg 文档站点搭建指南

本文档介绍如何使用 VitePress 搭建 Apq.Cfg 的文档站点，以及如何部署到国内有免费额度的平台。

## 为什么选择 VitePress

### VitePress vs VuePress 对比

| 特性 | VitePress | VuePress |
|------|-----------|----------|
| **构建工具** | Vite | Webpack |
| **Vue 版本** | Vue 3 | VuePress 1.x 用 Vue 2，2.x 用 Vue 3 |
| **开发服务器启动** | ⚡ 极快（毫秒级） | 较慢（秒级） |
| **热更新速度** | ⚡ 即时 | 较慢 |
| **打包体积** | 更小 | 较大 |
| **代码高亮** | Shiki（更好） | Prism |
| **搜索功能** | 内置本地搜索 | 需要插件 |
| **插件生态** | 较少但在增长 | 丰富 |

**结论**：对于新项目，推荐使用 VitePress，开发体验更好，构建更快。

## 快速开始

### 1. 安装依赖

```bash
cd docs/site
npm install
```

### 2. 本地开发

```bash
npm run docs:dev
```

访问 http://localhost:5173 查看文档站点。

### 3. 构建生产版本

```bash
npm run docs:build
```

构建产物位于 `.vitepress/dist` 目录。

### 4. 本地预览

```bash
npm run docs:preview
```

## 项目结构

```
docs/site/
├── .vitepress/
│   ├── config.mts      # VitePress 配置文件
│   └── dist/           # 构建输出目录
├── public/
│   └── logo.svg        # 站点 Logo
├── guide/              # 指南文档
│   ├── index.md
│   ├── getting-started.md
│   ├── installation.md
│   └── deploy.md
├── sources/            # 配置源文档
│   └── index.md
├── api/                # API 文档
│   └── index.md
├── best-practices/     # 最佳实践
│   └── index.md
├── performance/        # 性能优化
│   └── index.md
├── index.md            # 首页
└── package.json
```

## 部署到国内免费平台

### 推荐平台对比

| 平台 | 国内速度 | 免费额度 | 自动部署 | 推荐指数 |
|-----|---------|---------|---------|---------|
| **Gitee Pages** | ⭐⭐⭐⭐⭐ | 完全免费 | 需手动 | ⭐⭐⭐⭐⭐ |
| **Cloudflare Pages** | ⭐⭐⭐⭐ | 完全免费 | ✅ | ⭐⭐⭐⭐⭐ |
| **Vercel** | ⭐⭐⭐ | 100GB/月 | ✅ | ⭐⭐⭐⭐ |
| **Netlify** | ⭐⭐⭐ | 100GB/月 | ✅ | ⭐⭐⭐⭐ |
| **腾讯云 Webify** | ⭐⭐⭐⭐⭐ | 有限免费 | ✅ | ⭐⭐⭐⭐ |

### 方案一：Gitee Pages（推荐）

国内访问速度最快，完全免费。

**步骤：**

1. 修改 `base` 配置：
   ```ts
   // .vitepress/config.mts
   export default defineConfig({
     base: '/Apq.Cfg/',  // 仓库名
   })
   ```

2. 构建并推送：
   ```bash
   npm run docs:build
   cd .vitepress/dist
   git init
   git add -A
   git commit -m 'deploy'
   git push -f git@gitee.com:AlanPoon/Apq.Cfg.git main:gh-pages
   ```

3. 在 Gitee 仓库设置中启用 Gitee Pages，选择 `gh-pages` 分支

4. 访问 `https://alanpoon.gitee.io/Apq.Cfg/`

### 方案二：Cloudflare Pages

全球 CDN，国内访问速度较好，完全免费。

**步骤：**

1. 访问 [pages.cloudflare.com](https://pages.cloudflare.com)
2. 连接 Git 仓库
3. 配置构建：
   - Root directory: `docs/site`
   - Build command: `npm run docs:build`
   - Output directory: `.vitepress/dist`
4. 部署

### 方案三：Vercel

自动部署体验最好。

**步骤：**

1. 访问 [vercel.com](https://vercel.com)
2. 导入仓库
3. 配置：
   - Framework: VitePress
   - Root Directory: `docs/site`
4. 部署

创建 `docs/site/vercel.json`：
```json
{
  "buildCommand": "npm run docs:build",
  "outputDirectory": ".vitepress/dist",
  "framework": "vitepress"
}
```

### 方案四：Netlify

**步骤：**

1. 访问 [netlify.com](https://netlify.com)
2. 从 Git 创建新站点
3. 配置：
   - Base directory: `docs/site`
   - Build command: `npm run docs:build`
   - Publish directory: `docs/site/.vitepress/dist`

## GitHub Actions 自动部署

创建 `.github/workflows/docs.yml`：

```yaml
name: Deploy Docs

on:
  push:
    branches: [main]
    paths:
      - 'docs/site/**'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm
          cache-dependency-path: docs/site/package-lock.json

      - run: npm ci
        working-directory: docs/site

      - run: npm run docs:build
        working-directory: docs/site

      - uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: docs/site/.vitepress/dist
```

## 自定义配置

### 修改主题颜色

在 `.vitepress/theme/custom.css` 中：

```css
:root {
  --vp-c-brand-1: #42b883;
  --vp-c-brand-2: #35495e;
}
```

### 添加新页面

1. 在相应目录创建 `.md` 文件
2. 在 `config.mts` 的 `sidebar` 中添加链接

### 配置搜索

VitePress 内置本地搜索，已在配置中启用。如需 Algolia 搜索：

```ts
themeConfig: {
  search: {
    provider: 'algolia',
    options: {
      appId: '...',
      apiKey: '...',
      indexName: '...'
    }
  }
}
```

## 常见问题

### Q: 为什么 Gitee Pages 需要手动更新？

A: Gitee Pages 免费版不支持 Webhook 自动更新。可以：
1. 手动点击"更新"按钮
2. 使用 Gitee Pages Action 自动化

### Q: 如何同时部署到多个平台？

A: 在 GitHub Actions 中配置多个部署步骤，或使用不同的 workflow。

### Q: 国内访问 Vercel/Netlify 慢怎么办？

A: 
1. 配置自定义域名 + 国内 CDN
2. 同时部署到 Gitee Pages 作为国内镜像

## 相关链接

- [VitePress 官方文档](https://vitepress.dev/)
- [Gitee Pages 文档](https://gitee.com/help/articles/4136)
- [Cloudflare Pages 文档](https://developers.cloudflare.com/pages/)
- [Vercel 文档](https://vercel.com/docs)
