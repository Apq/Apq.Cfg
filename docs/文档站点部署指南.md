# Apq.Cfg 文档站点部署指南

本文档介绍如何将 Apq.Cfg 文档站点部署到各种静态网站托管平台。

## 技术栈

- **框架**: VitePress (Vue 3 + Vite)
- **运行时**: Node.js 20+
- **托管**: 腾讯云 CloudBase 静态网站托管

## 本地开发

### 环境要求

- Node.js 20.x 或更高版本
- npm 10.x 或更高版本

### 安装依赖

```bash
cd docs/site
npm install
```

### 启动开发服务器

```bash
npm run dev
```

访问 http://localhost:5173 查看文档站点。

### 构建生产版本

```bash
npm run build
```

构建产物位于 `docs/site/.vitepress/dist` 目录。

### 本地预览

```bash
npm run preview
```

## 腾讯云 CloudBase 部署

### 前置条件

1. 腾讯云账号
2. 已开通 CloudBase 服务
3. 已创建 CloudBase 环境

### 方式一：手动部署（推荐）

#### 1. 安装 CloudBase CLI

```bash
npm install -g @cloudbase/cli
```

#### 2. 登录

```bash
tcb login
```

#### 3. 初始化项目

```bash
cd docs/site
tcb init
```

选择已有环境或创建新环境。

#### 4. 部署

```bash
# 构建
npm run build

# 部署到 CloudBase
tcb hosting deploy .vitepress/dist -e your-env-id
```

### 方式二：使用 cloudbaserc.json

项目已包含 `cloudbaserc.json` 配置文件：

```json
{
  "envId": "your-env-id",
  "version": "2.0",
  "framework": {
    "name": "vitepress",
    "plugins": {
      "client": {
        "use": "@cloudbase/framework-plugin-website",
        "inputs": {
          "buildCommand": "npm run build",
          "outputPath": ".vitepress/dist",
          "cloudPath": "/"
        }
      }
    }
  }
}
```

修改 `envId` 为您的环境 ID，然后执行：

```bash
cd docs/site
tcb framework deploy
```

## 自定义域名

### 配置步骤

1. 登录 [CloudBase 控制台](https://console.cloud.tencent.com/tcb)
2. 选择您的环境
3. 进入「静态网站托管」-「设置」
4. 添加自定义域名
5. 配置 DNS 解析（CNAME 记录）
6. 等待 SSL 证书自动签发

### DNS 配置示例

```
类型: CNAME
主机记录: docs
记录值: your-env-id.tcloudbaseapp.com
```

## 目录结构

```
docs/site/
├── .vitepress/
│   ├── config.ts          # VitePress 配置
│   ├── theme/
│   │   ├── index.ts       # 主题配置
│   │   └── custom.css     # 自定义样式
│   ├── cache/             # 构建缓存（gitignore）
│   └── dist/              # 构建产物（gitignore）
├── public/
│   └── logo.svg           # 站点 Logo
├── guide/                 # 指南文档
├── config-sources/        # 配置源文档
├── api/                   # API 文档
├── examples/              # 示例文档
├── index.md               # 首页
├── changelog.md           # 更新日志
├── package.json           # 项目配置
├── cloudbaserc.json       # CloudBase 配置
└── .gitignore
```

## 常见问题

### Q: 部署后页面 404？

确保 CloudBase 静态网站托管已开启，并且部署路径正确。

### Q: 自定义域名无法访问？

1. 检查 DNS 解析是否生效（可能需要等待几分钟）
2. 确认 SSL 证书已签发
3. 检查域名是否已备案（国内域名需要）

### Q: 构建失败？

1. 检查 Node.js 版本是否 >= 20
2. 删除 `node_modules` 和 `package-lock.json` 后重新安装
3. 检查是否有语法错误

## Vercel 部署（推荐）

Vercel 是一个优秀的静态网站托管平台，个人项目**永久免费**，国内访问速度也不错。

### 优势

- ✅ 个人项目永久免费
- ✅ 自动部署（Git 推送即部署）
- ✅ 全球 CDN 加速
- ✅ 自动 HTTPS
- ✅ 支持自定义域名
- ✅ 预览部署（每个 PR 自动生成预览链接）

### 方式一：通过 Vercel 网站部署（推荐）

#### 1. 注册 Vercel 账号

访问 [vercel.com](https://vercel.com) 并使用 GitHub/GitLab/Bitbucket 账号登录。

#### 2. 导入项目

1. 点击 "Add New..." → "Project"
2. 选择 "Import Git Repository"
3. 授权并选择您的仓库

#### 3. 配置构建设置

在导入项目时，配置以下设置：

| 配置项 | 值 |
|--------|-----|
| Framework Preset | VitePress |
| Root Directory | `docs/site` |
| Build Command | `npm run build` |
| Output Directory | `.vitepress/dist` |
| Install Command | `npm install` |

#### 4. 部署

点击 "Deploy" 按钮，等待部署完成。部署成功后会获得一个 `*.vercel.app` 域名。

### 方式二：使用 Vercel CLI

#### 1. 安装 Vercel CLI

```bash
npm install -g vercel
```

#### 2. 登录

```bash
vercel login
```

#### 3. 部署

```bash
cd docs/site

# 首次部署（会引导配置）
vercel

# 后续部署到生产环境
vercel --prod
```

### 方式三：使用 vercel.json 配置文件

在 `docs/site` 目录下创建 `vercel.json`：

```json
{
  "buildCommand": "npm run build",
  "outputDirectory": ".vitepress/dist",
  "installCommand": "npm install",
  "framework": "vitepress"
}
```

然后执行：

```bash
cd docs/site
vercel --prod
```

### 自动部署配置

将仓库连接到 Vercel 后，每次推送到主分支都会自动触发部署。

#### GitHub Actions 集成（可选）

如果需要更精细的控制，可以使用 GitHub Actions：

```yaml
# .github/workflows/deploy-docs.yml
name: Deploy Docs to Vercel

on:
  push:
    branches: [main, master]
    paths:
      - 'docs/site/**'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: Install Vercel CLI
        run: npm install -g vercel
        
      - name: Deploy to Vercel
        run: |
          cd docs/site
          vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}
          vercel build --prod --token=${{ secrets.VERCEL_TOKEN }}
          vercel deploy --prebuilt --prod --token=${{ secrets.VERCEL_TOKEN }}
        env:
          VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
          VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}
```

需要在 GitHub 仓库设置中添加以下 Secrets：
- `VERCEL_TOKEN`: 从 Vercel 账户设置获取
- `VERCEL_ORG_ID`: 从 `.vercel/project.json` 获取
- `VERCEL_PROJECT_ID`: 从 `.vercel/project.json` 获取

### Vercel 自定义域名

1. 进入 Vercel 项目设置
2. 选择 "Domains"
3. 添加您的域名
4. 按提示配置 DNS 记录

```
# A 记录
类型: A
主机记录: @
记录值: 76.76.21.21

# 或 CNAME 记录
类型: CNAME
主机记录: docs
记录值: cname.vercel-dns.com
```

## Gitee Pages 部署

Gitee Pages 是国内访问速度最快的免费静态托管平台。

### 优势

- ✅ 完全免费，无时间限制
- ✅ 国内访问速度快
- ✅ 支持自定义域名

### 限制

- ⚠️ 需要实名认证
- ⚠️ 仓库大小限制 1GB
- ⚠️ 免费版需手动更新部署

### 部署步骤

#### 1. 构建项目

```bash
cd docs/site
npm run build
```

#### 2. 推送构建产物

将 `.vitepress/dist` 目录的内容推送到仓库的 `gh-pages` 分支：

```bash
# 方式一：使用 gh-pages 工具
npm install -g gh-pages
gh-pages -d .vitepress/dist

# 方式二：手动推送
cd .vitepress/dist
git init
git add -A
git commit -m 'deploy'
git push -f git@gitee.com:your-username/your-repo.git master:gh-pages
```

#### 3. 开启 Gitee Pages

1. 进入 Gitee 仓库
2. 点击「服务」→「Gitee Pages」
3. 选择部署分支为 `gh-pages`
4. 点击「启动」

#### 4. 更新部署

每次更新后需要手动点击「更新」按钮（免费版限制）。

## 相关链接

- [VitePress 官方文档](https://vitepress.dev/)
- [Vercel 官方文档](https://vercel.com/docs)
- [Gitee Pages 帮助](https://gitee.com/help/articles/4136)
- [腾讯云 CloudBase 文档](https://cloud.tencent.com/document/product/876)
- [CloudBase CLI 文档](https://docs.cloudbase.net/cli-v1/intro)
